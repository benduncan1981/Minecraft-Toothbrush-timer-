<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Oscar's Brush Quest</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
:root{
  --green:#55ff55;
  --red:#ff4444;
  --dark:#1a1a1a;
  --panel:#2b2b2b;
  --border:#000;
}

*{
  box-sizing:border-box;
  -webkit-tap-highlight-color:transparent;
}

body{
  margin:0;
  background:#111;
  color:white;
  font-family:'Press Start 2P', cursive;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  height:100vh;
}

header{
  text-align:center;
  padding:12px;
  font-size:14px;
}

#gameContainer{
  position:relative;
  flex:1;
}

canvas{
  display:block;
  width:100%;
  height:100%;
  image-rendering:pixelated;
}

#ui{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  text-align:center;
}

#timer{
  font-size:48px;
  margin-bottom:24px;
  text-shadow:4px 4px 0 #000;
}

.flash{
  animation:flash 0.5s infinite;
}

@keyframes flash{
  0%{color:var(--red);}
  50%{color:white;}
  100%{color:var(--red);}
}

button{
  font-family:'Press Start 2P', cursive;
  font-size:12px;
  padding:12px 16px;
  margin:6px;
  background:var(--panel);
  color:white;
  border:4px solid var(--border);
  box-shadow:4px 4px 0 #000;
}

button:active{
  transform:translate(2px,2px);
  box-shadow:2px 2px 0 #000;
}

#reward{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0.85);
  display:none;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  font-size:18px;
  text-align:center;
}
</style>
</head>
<body>

<header>Oscar's Brush Quest</header>

<div id="gameContainer">
  <canvas id="game"></canvas>

  <div id="ui">
    <div id="timer">02:00</div>
    <button onclick="startTimer()">START</button>
    <button onclick="pauseTimer()">PAUSE</button>
    <button onclick="resetTimer()">RESET</button>
  </div>

  <div id="reward">
    <div>✨ YOU DID IT! ✨</div>
    <button onclick="resetTimer()">PLAY AGAIN</button>
  </div>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const dpr=window.devicePixelRatio||1;

function resize(){
  canvas.width=window.innerWidth*dpr;
  canvas.height=window.innerHeight*dpr;
  canvas.style.width=window.innerWidth+"px";
  canvas.style.height=window.innerHeight+"px";
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener("resize",resize);
resize();

let total=120;
let remaining=120;
let running=false;
let lastSecond=-1;
let startTime=0;
let pauseOffset=0;

const timerEl=document.getElementById("timer");
const reward=document.getElementById("reward");

let audioCtx=null;

function beep(freq=600,duration=0.1){
  if(!audioCtx) return;
  const osc=audioCtx.createOscillator();
  const gain=audioCtx.createGain();
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.frequency.value=freq;
  gain.gain.value=0.1;
  osc.start();
  osc.stop(audioCtx.currentTime+duration);
}

function startTimer(){
  if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  if(running) return;
  running=true;
  startTime=Date.now()-pauseOffset;
  requestAnimationFrame(loop);
}

function pauseTimer(){
  running=false;
  pauseOffset=Date.now()-startTime;
}

function resetTimer(){
  running=false;
  remaining=total;
  pauseOffset=0;
  lastSecond=-1;
  timerEl.textContent="02:00";
  timerEl.classList.remove("flash");
  reward.style.display="none";
  particles=[];
  mobs=[];
  draw();
}

function formatTime(s){
  const m=Math.floor(s/60);
  const sec=s%60;
  return String(m).padStart(2,"0")+":"+String(sec).padStart(2,"0");
}

let mobs=[];
let particles=[];

function spawnMob(){
  if(mobs.length>15) return;
  mobs.push({
    x:Math.random()*canvas.width/dpr,
    y:canvas.height/dpr-40,
    dir:Math.random()>0.5?1:-1
  });
}

function spawnFireworks(){
  for(let i=0;i<100;i++){
    particles.push({
      x:canvas.width/(2*dpr),
      y:canvas.height/(2*dpr),
      vx:(Math.random()-0.5)*6,
      vy:(Math.random()-0.5)*6,
      life:80
    });
  }
}

function update(){
  if(running){
    const elapsed=Math.floor((Date.now()-startTime)/1000);
    remaining=total-elapsed;
    if(remaining<=0){
      remaining=0;
      running=false;
      reward.style.display="flex";
      spawnFireworks();
      beep(900,0.3);
    }
    if(remaining!==lastSecond){
      lastSecond=remaining;
      if(remaining>0){
        if(remaining<=10) beep(1200,0.15);
        else beep(600,0.05);
        spawnMob();
      }
    }
  }

  mobs.forEach(m=>m.x+=m.dir*0.5);
  mobs=mobs.filter(m=>m.x>-20 && m.x<canvas.width/dpr+20);

  particles.forEach(p=>{
    p.x+=p.vx;
    p.y+=p.vy;
    p.vy+=0.1;
    p.life--;
  });
  particles=particles.filter(p=>p.life>0);
}

function draw(){
  ctx.fillStyle="#87CEEB";
  ctx.fillRect(0,0,canvas.width/dpr,canvas.height/dpr);

  ctx.fillStyle="#228B22";
  ctx.fillRect(0,canvas.height/dpr-60,canvas.width/dpr,60);

  mobs.forEach(m=>{
    ctx.fillStyle="#8B4513";
    ctx.fillRect(m.x,m.y,20,20);
  });

  particles.forEach(p=>{
    ctx.fillStyle="yellow";
    ctx.fillRect(p.x,p.y,4,4);
  });
}

function loop(){
  update();
  draw();
  timerEl.textContent=formatTime(remaining);

  if(remaining<=10 && remaining>0){
    timerEl.classList.add("flash");
  } else {
    timerEl.classList.remove("flash");
  }

  if(running||particles.length>0)
    requestAnimationFrame(loop);
}

draw();
</script>
</body>
</html>
