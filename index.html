<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Oscar's Brushing Adventure</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

html,body{
  margin:0;
  padding:0;
  height:100%;
  overflow:hidden;
  background:#000;
  font-family:'Press Start 2P', monospace;
  color:#fff;
}

canvas{
  display:block;
  width:100vw;
  height:100vh;
  image-rendering:pixelated;
}

#ui{
  position:fixed;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  text-align:center;
  z-index:10;
}

#timer{
  font-size:34px;
  margin-bottom:10px;
  text-shadow:0 0 10px rgba(255,255,255,0.6);
}

#xpContainer{
  width:260px;
  height:16px;
  border:3px solid #222;
  background:#111;
  margin:0 auto 12px;
}

#xp{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#7CFC00,#32CD32);
  box-shadow:0 0 10px #7CFC00;
}

button{
  font-family:'Press Start 2P';
  padding:8px 14px;
  margin:4px;
  background:#222;
  border:2px solid #444;
  color:#fff;
  cursor:pointer;
}

button:active{
  transform:translateY(2px);
}

#reward{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  background:rgba(0,0,0,0.95);
  z-index:20;
}
</style>
</head>
<body>

<canvas id="world"></canvas>

<div id="ui">
  <div id="timer">2:00</div>
  <div id="xpContainer"><div id="xp"></div></div>
  <div>
    <button id="start">START</button>
    <button id="pause" style="display:none">PAUSE</button>
    <button id="reset" style="display:none">RESET</button>
  </div>
</div>

<div id="reward">
  <div style="font-size:24px;margin-bottom:20px;">SUPER BRUSHER</div>
  <button onclick="restart()">PLAY AGAIN</button>
</div>

<script>
const canvas = document.getElementById('world');
const ctx = canvas.getContext('2d');
let W,H;

function resize(){
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
window.addEventListener('resize',resize);
resize();

const TOTAL = 120;
let elapsed = 0;
let running = false;
let lastSecond = -1;
let biomeIndex = 0;

const timerEl = document.getElementById('timer');
const xpEl = document.getElementById('xp');

const biomes = [
  {sky:'#87CEEB',ground:'#4CAF50'},
  {sky:'#FFA500',ground:'#C2B280'},
  {sky:'#6A5ACD',ground:'#2F4F4F'},
  {sky:'#000000',ground:'#222'}
];

let cameraY = 0;
let mobs = [];
let particles = [];

function spawnMob(){
  mobs.push({
    x:Math.random()*W,
    y:H*0.55 + Math.random()*100,
    dir:Math.random()<0.5?-1:1,
    speed:0.5+Math.random()
  });
}

function drawSky(color){
  ctx.fillStyle = color;
  ctx.fillRect(0,0,W,H);
}

function drawGround(color){
  ctx.fillStyle = color;
  ctx.fillRect(0,H*0.5,W,H*0.5);
}

function drawSun(){
  ctx.fillStyle='#FFD700';
  ctx.beginPath();
  ctx.arc(W*0.8,80,30,0,Math.PI*2);
  ctx.fill();
}

function drawTrees(){
  for(let i=0;i<5;i++){
    const x = (i*200 + elapsed*40) % W;
    ctx.fillStyle='#8B4513';
    ctx.fillRect(x,H*0.5-60,20,60);
    ctx.fillStyle='#2E8B57';
    ctx.fillRect(x-20,H*0.5-90,60,40);
  }
}

function drawWater(){
  ctx.fillStyle='#1E90FF';
  ctx.fillRect(0,H*0.65,W,40);
}

function drawHand(){
  const bob = Math.sin(elapsed*10)*5;
  ctx.fillStyle='#F1C27D';
  ctx.fillRect(W/2-20,H-100+bob,40,60);
  ctx.fillStyle='#fff';
  ctx.fillRect(W/2-10,H-120+bob,20,20);
}

function updateMobs(){
  mobs.forEach(m=>{
    m.x += m.speed*m.dir;
    if(m.x<0||m.x>W) m.dir*=-1;
    ctx.fillStyle='#fff';
    ctx.fillRect(m.x,m.y,20,20);
  });
}

function spawnParticles(x,y,color){
  for(let i=0;i<20;i++){
    particles.push({
      x,y,
      vx:(Math.random()-0.5)*4,
      vy:(Math.random()-0.5)*4,
      life:60,
      color
    });
  }
}

function updateParticles(){
  particles.forEach(p=>{
    ctx.fillStyle=p.color;
    ctx.fillRect(p.x,p.y,4,4);
    p.x+=p.vx;
    p.y+=p.vy;
    p.life--;
  });
  particles=particles.filter(p=>p.life>0);
}

function update(dt){
  if(!running) return;

  elapsed+=dt;

  const sec = Math.floor(elapsed);
  if(sec!==lastSecond){
    lastSecond=sec;
    spawnMob();
  }

  const remaining = TOTAL - sec;
  timerEl.textContent = formatTime(remaining);
  xpEl.style.width = (elapsed/TOTAL*100)+'%';

  if(remaining<=10){
    timerEl.style.color = sec%2?'#ff0000':'#fff';
  } else {
    timerEl.style.color = '#fff';
  }

  biomeIndex = Math.floor(elapsed/30)%biomes.length;

  if(elapsed>=TOTAL){
    running=false;
    showReward();
  }
}

function formatTime(s){
  s=Math.max(0,s);
  const m=Math.floor(s/60);
  const sec=s%60;
  return m+':'+(sec<10?'0':'')+sec;
}

function draw(){
  const biome = biomes[biomeIndex];
  drawSky(biome.sky);
  drawGround(biome.ground);
  drawSun();
  drawTrees();
  drawWater();
  updateMobs();
  updateParticles();
  drawHand();
}

let lastTime = performance.now();
function loop(now){
  const dt = Math.min(0.05,(now-lastTime)/1000);
  lastTime = now;
  update(dt);
  draw();
  if(running||particles.length>0)
    requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

document.getElementById('start').onclick=()=>{
  running=true;
  document.getElementById('start').style.display='none';
  document.getElementById('pause').style.display='inline-block';
  document.getElementById('reset').style.display='inline-block';
};

document.getElementById('pause').onclick=()=>{
  running=false;
  document.getElementById('pause').style.display='none';
  document.getElementById('start').style.display='inline-block';
};

document.getElementById('reset').onclick=()=>restart();

function restart(){
  elapsed=0;
  mobs=[];
  particles=[];
  running=true;
  document.getElementById('reward').style.display='none';
}

function showReward(){
  spawnParticles(W/2,H/2,'#7CFC00');
  document.getElementById('reward').style.display='flex';
}
</script>
</body>
</html>
