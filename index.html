<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Oscar's Brushing Adventure</title>
<meta name="description" content="A Minecraft-style 2-minute toothbrush timer for kids with animated landscapes and rewards.">
<style>
:root {
  --accent: #7CFC00;
  --hud-bg: rgba(0,0,0,0.6);
  --panel-radius: 12px;
  --font-minecraft: "Press Start 2P", monospace;
}
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

html, body { height: 100%; margin:0; background:#000; font-family: var(--font-minecraft); color:#fff; overflow:hidden; }
canvas { display:block; width:100vw; height:100vh; image-rendering:pixelated; background:#000; }
.panel { background: var(--hud-bg); border:2px solid #555; border-radius: var(--panel-radius); padding:6px 10px; display:flex; gap:8px; align-items:center; }
#hud { position:fixed; top:12px; left:12px; z-index:50; flex-direction:column; gap:10px; }
#controls { position:fixed; bottom:12px; left:50%; transform:translateX(-50%); z-index:51; gap:6px; display:flex; }
button { font-family:var(--font-minecraft); font-size:10px; padding:6px 10px; border-radius:6px; border:2px solid #555; background:rgba(0,0,0,0.6); color:#fff; cursor:pointer; }
button:active { transform:translateY(1px); }
#timer { font-size:28px; font-weight:700; text-align:center; min-width:80px; }
#xpBar { width:220px; height:14px; background:#222; border-radius:6px; overflow:hidden; border:2px solid #333; }
#xpFill { height:100%; width:0%; background:var(--accent); transition: width 0.1s linear; }
#reward { position:fixed; inset:0; display:none; align-items:center; justify-content:center; flex-direction:column; background:rgba(0,0,0,0.95); color:#fff; z-index:60; font-size:18px; text-align:center; }
#reward button { margin-top:12px; }
</style>
</head>
<body>

<canvas id="game" aria-label="Brushing Adventure Canvas"></canvas>

<div id="hud">
  <div class="panel">
    <div id="timer">2:00</div>
  </div>
  <div class="panel">
    <div style="font-size:12px;">Progress</div>
    <div id="xpBar"><div id="xpFill"></div></div>
  </div>
</div>

<div id="controls">
  <button id="startBtn">Start</button>
  <button id="pauseBtn" style="display:none">Pause</button>
  <button id="resetBtn" style="display:none">Reset</button>
</div>

<div id="reward">
  <div style="font-size:24px; font-weight:700;">ðŸŽ‰ Super Brusher! ðŸŽ‰</div>
  <div style="margin-top:6px;">You've brushed for 2 minutes!</div>
  <button id="restartReward">Play Again</button>
</div>

<script>
// ----- Canvas setup -----
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d', { alpha: false });
let DPR = Math.max(1, window.devicePixelRatio || 1);
function resizeCanvas(){
  DPR = Math.max(1, window.devicePixelRatio || 1);
  canvas.width = Math.floor(window.innerWidth * DPR);
  canvas.height = Math.floor(window.innerHeight * DPR);
  canvas.style.width = window.innerWidth + 'px';
  canvas.style.height = window.innerHeight + 'px';
  ctx.setTransform(DPR,0,0,DPR,0,0);
  ctx.imageSmoothingEnabled = false;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// ----- Game state -----
const TOTAL_TIME = 120;
let elapsed = 0;
let running = false;
let lastSecond = -1;

// ----- UI references -----
const timerEl = document.getElementById('timer');
const xpFill = document.getElementById('xpFill');
const startBtn = document.getElementById('startBtn');
const pauseBtn = document.getElementById('pauseBtn');
const resetBtn = document.getElementById('resetBtn');
const reward = document.getElementById('reward');
const restartReward = document.getElementById('restartReward');

let audioCtx=null;
function ensureAudio(){ if(audioCtx) return audioCtx; const C = window.AudioContext||window.webkitAudioContext; if(!C) return null; audioCtx = new C(); return audioCtx; }
function beep(){ const a=ensureAudio(); if(!a) return; const now=a.currentTime; const o=a.createOscillator(); const g=a.createGain(); o.type='square'; o.frequency.value=700; g.gain.setValueAtTime(0,now); g.gain.linearRampToValueAtTime(0.08, now+0.005); g.gain.exponentialRampToValueAtTime(0.0001, now+0.08); o.connect(g); g.connect(a.destination); o.start(now); o.stop(now+0.09); }

// ----- Controls -----
function startGame(){ 
  const a=ensureAudio(); if(a&&a.state==='suspended') a.resume();
  running=true; elapsed=0; lastSecond=-1;
  startBtn.style.display='none'; pauseBtn.style.display='inline-block'; resetBtn.style.display='inline-block';
  requestAnimationFrame(loop);
}
function pauseGame(){ running=false; pauseBtn.style.display='none'; startBtn.textContent='Resume'; startBtn.style.display='inline-block'; }
function resetGame(){ running=false; elapsed=0; lastSecond=-1; timerEl.textContent=formatTime(TOTAL_TIME); xpFill.style.width='0%'; startBtn.textContent='Start'; startBtn.style.display='inline-block'; pauseBtn.style.display='none'; resetBtn.style.display='none'; reward.style.display='none'; }
startBtn.addEventListener('click',()=>{ startGame(); });
pauseBtn.addEventListener('click',()=>{ pauseGame(); });
resetBtn.addEventListener('click',()=>{ resetGame(); });
restartReward.addEventListener('click',()=>{ resetGame(); startGame(); });

// ----- Helpers -----
function formatTime(sec){ sec=Math.max(0, Math.ceil(sec)); const m=Math.floor(sec/60); const s=sec%60; return m+':' + (s<10?'0':'') + s; }

// ----- Simple landscape rendering -----
function drawLandscape(){
  const W=canvas.width/DPR;
  const H=canvas.height/DPR;
  // sky
  ctx.fillStyle='#87CEEB';
  ctx.fillRect(0,0,W,H*0.4);
  // sun
  ctx.fillStyle='#FFD700'; ctx.beginPath(); ctx.arc(W*0.85,H*0.15,20,0,Math.PI*2); ctx.fill();
  // ground
  ctx.fillStyle='#4CAF50'; ctx.fillRect(0,H*0.4,W,H*0.6);
  // simple trees
  for(let i=0;i<5;i++){
    const x=(i*100+elapsed*10)%W; const y=H*0.4; ctx.fillStyle='#8B4513'; ctx.fillRect(x,y-40,10,40); ctx.fillStyle='#2E7D32'; ctx.beginPath(); ctx.moveTo(x-15,y-40); ctx.lineTo(x+25,y-40); ctx.lineTo(x+5,y-70); ctx.closePath(); ctx.fill();
  }
  // flowers
  for(let i=0;i<10;i++){
    const x=(i*60+elapsed*15)%W; const y=H*0.4+Math.random()*100; ctx.fillStyle=['#FF0000','#FF69B4','#FFFF00'][i%3]; ctx.fillRect(x,y,4,4);
  }
}

// ----- Update -----
let lastTime=performance.now();
function update(dt){
  if(!running) return;
  elapsed+=dt;
  const sec=Math.floor(elapsed);
  if(sec!==lastSecond){
    lastSecond=sec;
    beep();
    // flash last 10 seconds
    if(TOTAL_TIME-sec<=10){
      timerEl.style.color=(sec%2===0?'#FF0000':'#fff');
    } else timerEl.style.color='#fff';
    timerEl.textContent=formatTime(TOTAL_TIME-sec);
    const progress=Math.min(1, elapsed/TOTAL_TIME);
    xpFill.style.width=(progress*100)+'%';
  }
  if(elapsed>=TOTAL_TIME){ running=false; showReward(); }
}

// ----- Reward -----
function showReward(){ reward.style.display='flex'; }

// ----- Render -----
function draw(){ ctx.clearRect(0,0,canvas.width/DPR,canvas.height/DPR); drawLandscape(); }

function loop(now){
  const dt=Math.min(0.05,(now-lastTime)/1000);
  lastTime=now;
  update(dt);
  draw();
  if(running) requestAnimationFrame(loop);
}
</script>
</body>
</html>
