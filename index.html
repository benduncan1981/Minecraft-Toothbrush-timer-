<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Oscar's Tooth Quest</title>
<style>
body {margin:0; overflow:hidden; font-family:'Press Start 2P', monospace; background:black;}
canvas {image-rendering: pixelated; display:block;}
#ui {
  position:absolute; top:5px; left:5px; color:white; z-index:10; font-size:18px;
  text-shadow:2px 2px 4px black;
}
button {
  display:block; margin-top:5px; font-size:16px; padding:5px 10px;
}
#reward {position:absolute; bottom:20px; width:100%; text-align:center; font-size:24px; color:gold; text-shadow:2px 2px 4px black;}
</style>
</head>
<body>
<canvas id="game"></canvas>

<div id="ui">
  <div id="timer">02:00</div>
  <div id="biome">Tap Start to Begin</div>
  <div id="streak"></div>
  <div id="totalDays"></div>
  <button id="startBtn">START BRUSHING</button>
  <button id="manualBtn">Add Manual Brush</button>
</div>
<div id="reward"></div>

<script>
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
let cw=canvas.width=window.innerWidth;
let ch=canvas.height=window.innerHeight;

const TILE=32;
let brushing=false;
let startTime=0;
let arrows=[];
let dragonX=0, dragonDir=2;
let rewardMessage="";

const biomes=['Plains','Flower Forest','Nether','The End'];

// Touch-friendly zones
let zones=[
  {x:0,y:0,w:0,h:0,brushed:false},
  {x:0,y:0,w:0,h:0,brushed:false},
  {x:0,y:0,w:0,h:0,brushed:false},
  {x:0,y:0,w:0,h:0,brushed:false}
];

// ---------- STORAGE ----------
function getToday(){return new Date().toISOString().split('T')[0];}
function loadData(){return {streak:parseInt(localStorage.getItem('streak')||0), total:parseInt(localStorage.getItem('totalDays')||0), last:localStorage.getItem('lastDate')||""};}
function saveData(d){localStorage.setItem('streak',d.streak); localStorage.setItem('totalDays',d.total); localStorage.setItem('lastDate',d.last);}
function updateUI(){let d=loadData(); document.getElementById('streak').innerText="Streak: "+d.streak; document.getElementById('totalDays').innerText="Total days brushed: "+d.total;}
function rewardCheck(streak){if(streak%7===0) rewardMessage="Weekly Reward Unlocked!";}
function registerBrush(){
  let d=loadData(); const today=getToday();
  if(d.last!==today){
    let y=new Date(); y.setDate(y.getDate()-1); const yd=y.toISOString().split('T')[0];
    if(d.last===yd) d.streak++; else d.streak=1;
    d.total++; d.last=today;
    rewardCheck(d.streak); saveData(d); updateUI();
  }
}

// ---------- START ----------
function startBrush(){brushing=true; startTime=Date.now(); arrows=[]; rewardMessage=""; zones.forEach(z=>z.brushed=false); document.getElementById('biome').innerText="Overworld Plains";}

// ---------- BLOCK DRAW ----------
function block(x,y,w,h,color){ctx.fillStyle=color; ctx.fillRect(x,y,w,h); ctx.strokeStyle='rgba(0,0,0,0.2)'; ctx.strokeRect(x,y,w,h);}

// ---------- BIOMES ----------
function drawPlains(){
  ctx.fillStyle='#87CEEB'; ctx.fillRect(0,0,cw,ch);
  for(let x=0;x<cw;x+=TILE) block(x,ch-200,TILE,200,'#3CB043');
  drawCloud(200,100); drawCloud(500,150); drawTree(cw*0.2,ch-240); drawTree(cw*0.6,ch-240);
  drawSheep(cw*0.4,ch-180);
  updateZones(ch-250,ch-180);
}
function drawFlowerForest(){
  ctx.fillStyle='#A7D8FF'; ctx.fillRect(0,0,cw,ch);
  for(let x=0;x<cw;x+=TILE) block(x,ch-200,TILE,200,'#4CAF50');
  drawCloud(300,120); drawCloud(600,160); drawTree(cw*0.3,ch-240); drawTree(cw*0.7,ch-240);
  drawSheep(cw*0.5,ch-180);
  for(let i=0;i<10;i++){ctx.fillStyle='pink'; ctx.fillRect(i*100,ch-210,8,8);}
  updateZones(ch-250,ch-180);
}
function drawNether(){
  ctx.fillStyle='#330000'; ctx.fillRect(0,0,cw,ch);
  for(let x=0;x<cw;x+=TILE) block(x,ch-200,TILE,200,'#8B0000');
  ctx.fillStyle='orange'; ctx.fillRect(0,ch-100,cw,100);
  drawPiglin(cw/2,ch-180);
}
function drawEnd(){
  ctx.fillStyle='#111122'; ctx.fillRect(0,0,cw,ch);
  for(let x=0;x<cw;x+=TILE) block(x,ch-200,TILE,200,'#444');
  drawDragon();
  arrows.forEach(a=>{a.y-=8; ctx.fillStyle='white'; ctx.fillRect(a.x,a.y,4,20);});
}

// ---------- OBJECTS ----------
function drawCloud(x,y){ctx.fillStyle='white'; ctx.fillRect(x,y,96,32); ctx.fillRect(x+16,y-16,64,32);}
function drawTree(x,y){block(x,y,32,64,'#8B5A2B'); ctx.fillStyle='#228B22'; ctx.fillRect(x-16,y-32,64,64);}
function drawSheep(x,y){ctx.fillStyle='white'; ctx.fillRect(x,y,32,16);}
function drawPiglin(x,y){ctx.fillStyle='#ffb6c1'; ctx.fillRect(x,y,32,24);}
function drawDragon(){dragonX+=dragonDir; if(dragonX<100||dragonX>cw-200) dragonDir*=-1; ctx.fillStyle='#551A8B'; ctx.fillRect(dragonX,150,160,32); ctx.fillRect(dragonX+40,120,64,32);}

// ---------- ZONES ----------
function updateZones(top,bottom){
  const width=cw/4-20;
  for(let i=0;i<4;i++){
    zones[i].x=20+i*(width+10); zones[i].y=top; zones[i].w=width; zones[i].h=bottom-top;
  }
}
canvas.addEventListener('pointerdown',e=>{
  if(!brushing) return;
  const rect=canvas.getBoundingClientRect();
  const mx=e.clientX-rect.left, my=e.clientY-rect.top;
  zones.forEach(z=>{
    if(!z.brushed && mx>z.x && mx<z.x+z.w && my>z.y && my<z.y+z.h){
      z.brushed=true;
      for(let i=0;i<5;i++){ctx.fillStyle='pink'; ctx.fillRect(z.x+Math.random()*z.w,z.y+Math.random()*z.h,4,4);}
      if('vibrate' in navigator) navigator.vibrate(50);
      if(getBiomeIndex()===3) arrows.push({x:mx,y:my});
    }
  });
});

// ---------- LOOP ----------
function getBiomeIndex(){return Math.min(Math.floor((Date.now()-startTime)/1000/30),3);}
function animate(){
  requestAnimationFrame(animate);
  ctx.clearRect(0,0,cw,ch);
  if(!brushing) return;
  const elapsed=(Date.now()-startTime)/1000;
  const timeLeft=Math.max(0,120-elapsed);
  document.getElementById('timer').innerText='Time: '+Math.ceil(timeLeft);
  const biomeIndex=getBiomeIndex();
  document.getElementById('biome').innerText='Biome: '+biomes[biomeIndex];
  if(biomeIndex===0) drawPlains();
  else if(biomeIndex===1) drawFlowerForest();
  else if(biomeIndex===2) drawNether();
  else drawEnd();
  if(elapsed>=120){brushing=false; registerBrush(); document.getElementById('reward').innerText=rewardMessage;}
}

// ---------- BUTTONS ----------
document.getElementById('startBtn').addEventListener('click',startBrush);
document.getElementById('manualBtn').addEventListener('click',()=>{registerBrush();});

// ---------- INIT ----------
updateUI();
animate();

// ---------- RESIZE ----------
window.addEventListener('resize',()=>{
  cw=canvas.width=window.innerWidth;
  ch=canvas.height=window.innerHeight;
});
</script>
</body>
</html>
