<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Minecraft Brush Quest</title>
<style>
body { margin:0; overflow:hidden; background:black; font-family:Arial; }
#ui {
  position:absolute;
  top:10px;
  left:10px;
  color:white;
  z-index:10;
  font-size:18px;
}
button { margin-top:4px; font-size:16px; }
#reward {
  position:absolute;
  bottom:20px;
  width:100%;
  text-align:center;
  font-size:28px;
  color:gold;
}
</style>
</head>
<body>

<div id="ui">
  <div id="timer"></div>
  <div id="biome"></div>
  <div id="streak"></div>
  <div id="total"></div>
  <button onclick="startBrush()">Start Brushing</button>
  <button onclick="manualBrush()">Add Manual Brush</button>
</div>
<div id="reward"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

<script>
/* ---------- BASIC SETUP ---------- */

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

camera.position.set(0,10,25);

const light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(10,20,10);
light.castShadow = true;
scene.add(light);
scene.add(new THREE.AmbientLight(0x888888));

/* ---------- WORLD OBJECTS ---------- */

let worldGroup = new THREE.Group();
scene.add(worldGroup);

function clearWorld(){
  while(worldGroup.children.length > 0){
    worldGroup.remove(worldGroup.children[0]);
  }
}

function createGround(color){
  const geo = new THREE.BoxGeometry(100,2,100);
  const mat = new THREE.MeshLambertMaterial({color});
  const ground = new THREE.Mesh(geo,mat);
  ground.position.y = -1;
  ground.receiveShadow = true;
  worldGroup.add(ground);
}

function createTree(x,z){
  const trunk = new THREE.Mesh(
    new THREE.BoxGeometry(1,4,1),
    new THREE.MeshLambertMaterial({color:0x8b5a2b})
  );
  trunk.position.set(x,2,z);
  trunk.castShadow = true;

  const leaves = new THREE.Mesh(
    new THREE.BoxGeometry(4,4,4),
    new THREE.MeshLambertMaterial({color:0x228b22})
  );
  leaves.position.set(x,5,z);
  leaves.castShadow = true;

  worldGroup.add(trunk);
  worldGroup.add(leaves);
}

function createAnimal(x,z,color){
  const body = new THREE.Mesh(
    new THREE.BoxGeometry(2,2,3),
    new THREE.MeshLambertMaterial({color})
  );
  body.position.set(x,1,z);
  body.castShadow = true;
  worldGroup.add(body);
}

let dragon;
let arrows = [];

function createDragon(){
  dragon = new THREE.Mesh(
    new THREE.BoxGeometry(8,2,3),
    new THREE.MeshLambertMaterial({color:0x551a8b})
  );
  dragon.position.set(0,15,0);
  dragon.castShadow = true;
  worldGroup.add(dragon);
}

function fireArrow(){
  const arrow = new THREE.Mesh(
    new THREE.BoxGeometry(0.3,3,0.3),
    new THREE.MeshBasicMaterial({color:0xffffff})
  );
  arrow.position.set(0,1,20);
  arrows.push(arrow);
  worldGroup.add(arrow);
}

/* ---------- BIOMES ---------- */

function loadBiome(index){
  clearWorld();
  arrows = [];

  if(index === 0){
    scene.background = new THREE.Color(0x87ceeb);
    createGround(0x3cb043);
    createTree(-10,-5);
    createTree(5,-8);
    createAnimal(0,-5,0xffffff);
  }

  if(index === 1){
    scene.background = new THREE.Color(0x6b8eae);
    createGround(0x4a7023);
    createTree(-8,-4);
    createTree(8,-6);
    createAnimal(4,-4,0xff6600);
  }

  if(index === 2){
    scene.background = new THREE.Color(0x330000);
    createGround(0x8b0000);
    createAnimal(0,-5,0xffb6c1);
  }

  if(index === 3){
    scene.background = new THREE.Color(0x111122);
    createGround(0x444444);
    createDragon();
  }
}

/* ---------- TIMER + STREAK ---------- */

let brushing = false;
let startTime = 0;
let currentBiome = -1;

function getToday(){
  return new Date().toISOString().split("T")[0];
}

function loadData(){
  return {
    streak: parseInt(localStorage.getItem("streak")||0),
    total: parseInt(localStorage.getItem("totalDays")||0),
    last: localStorage.getItem("lastDate")||""
  };
}

function saveData(d){
  localStorage.setItem("streak",d.streak);
  localStorage.setItem("totalDays",d.total);
  localStorage.setItem("lastDate",d.last);
}

function updateUI(){
  const d = loadData();
  document.getElementById("streak").innerText = "Streak: "+d.streak;
  document.getElementById("total").innerText = "Total days: "+d.total;
}

function registerBrush(){
  let d = loadData();
  const today = getToday();
  if(d.last !== today){
    let y = new Date();
    y.setDate(y.getDate()-1);
    let yd = y.toISOString().split("T")[0];

    if(d.last === yd) d.streak++;
    else d.streak = 1;

    d.total++;
    d.last = today;
    saveData(d);

    if(d.streak % 7 === 0){
      document.getElementById("reward").innerText = "Weekly Reward Unlocked!";
    }

    updateUI();
  }
}

function manualBrush(){
  registerBrush();
}

function startBrush(){
  brushing = true;
  startTime = Date.now();
  document.getElementById("reward").innerText = "";
}

/* ---------- MAIN LOOP ---------- */

function animate(){
  requestAnimationFrame(animate);

  if(brushing){
    const elapsed = (Date.now() - startTime)/1000;
    const timeLeft = Math.max(0,120 - elapsed);
    document.getElementById("timer").innerText = "Time: "+Math.ceil(timeLeft);

    let biomeIndex = Math.floor(elapsed/30);
    if(biomeIndex > 3) biomeIndex = 3;

    if(biomeIndex !== currentBiome){
      currentBiome = biomeIndex;
      loadBiome(biomeIndex);
      document.getElementById("biome").innerText = "Biome: "+["Plains","Taiga","Nether","The End"][biomeIndex];
    }

    if(currentBiome === 3 && dragon){
      dragon.position.x = Math.sin(Date.now()*0.002)*15;
      dragon.position.z = Math.cos(Date.now()*0.002)*10;

      if(Math.random() < 0.05){
        fireArrow();
      }
    }

    arrows.forEach(a => {
      a.position.z -= 0.5;
    });

    if(elapsed >= 120){
      brushing = false;
      registerBrush();
    }
  }

  renderer.render(scene,camera);
}

updateUI();
animate();
</script>

</body>
</html>
