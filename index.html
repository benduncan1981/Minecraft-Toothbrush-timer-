<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Oscar's Pixel Brushing Quest</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
:root{
  --sky:#7ec0ee;
  --grass1:#5fbf3f;
  --grass2:#4aa52e;
  --dirt1:#7a4b1f;
  --dirt2:#5e3716;
  --stone1:#9ea7ad;
  --stone2:#7f8a90;
  --xp:#ff69b4;
}

/* Reset + basic styling */
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{margin:0;font-family:'Press Start 2P',monospace;color:white;height:100vh;overflow:hidden;display:flex;justify-content:center;align-items:center;background:repeating-linear-gradient(0deg,var(--grass1) 0px,var(--grass1) 8px,var(--grass2) 8px,var(--grass2) 16px);}
.sky{position:absolute;top:0;width:100%;height:40%;background:repeating-linear-gradient(90deg,var(--sky) 0px,var(--sky) 16px,#6bb5e5 16px,#6bb5e5 32px);}
.sun{position:absolute;top:20px;right:40px;width:64px;height:64px;background:repeating-linear-gradient(0deg,#ffd800 0px,#ffd800 8px,#ffcc00 8px,#ffcc00 16px);border:4px solid #e6b800;image-rendering:pixelated;}
.cloud{position:absolute;width:80px;height:32px;background:white;image-rendering:pixelated;animation:cloudMove 40s linear infinite;}
@keyframes cloudMove{from{left:-100px;}to{left:110%;}}
.container{position:relative;text-align:center;width:90%;max-width:480px;background:repeating-linear-gradient(45deg,var(--stone1) 0px,var(--stone1) 8px,var(--stone2) 8px,var(--stone2) 16px);border:8px solid black;padding:20px;box-shadow:0 0 0 8px #333;}
h1{font-size:14px;margin-bottom:15px;text-shadow:4px 4px black;}
.timer{font-size:36px;margin:20px 0;text-shadow:5px 5px black;}
.zone{font-size:10px;margin-bottom:10px;color:#ff8cf0;}
button{font-family:'Press Start 2P',monospace;background:repeating-linear-gradient(0deg,var(--dirt1) 0px,var(--dirt1) 8px,var(--dirt2) 8px,var(--dirt2) 16px);border:6px solid black;color:white;padding:14px;width:100%;font-size:10px;margin-top:15px;box-shadow:4px 4px #000;}
button:active{transform:translate(4px,4px);box-shadow:none;}
.xp-bar{width:100%;height:18px;background:#222;border:4px solid black;margin-top:15px;position:relative;}
.xp-fill{height:100%;width:0%;background:repeating-linear-gradient(90deg,var(--xp) 0px,var(--xp) 8px,#ff85c1 8px,#ff85c1 16px);transition:width 0.5s linear;}
.orb{position:absolute;width:8px;height:8px;background:var(--xp);animation:orbRise 2s linear forwards;}
@keyframes orbRise{to{transform:translateY(-120px);opacity:0;}}
.warning{animation:flash 0.5s infinite;}
@keyframes flash{0%,100%{filter:none;}50%{filter:brightness(1.8);}}
.achievement{position:absolute;top:20%;left:50%;transform:translateX(-50%);background:black;border:6px solid gold;padding:20px;display:none;text-align:center;animation:pop 0.4s ease-out forwards;}
@keyframes pop{from{transform:translateX(-50%) scale(0.5);}to{transform:translateX(-50%) scale(1);}}
</style>
</head>
<body>

<div class="sky"></div>
<div class="sun"></div>
<div class="cloud" style="top:40px;"></div>
<div class="cloud" style="top:80px; animation-duration:60s;"></div>

<div class="container">
  <h1>Oscar's Tooth Quest</h1>
  <div class="timer" id="timer">02:00</div>
  <div class="zone" id="zone">Tap Start To Begin</div>
  <button id="startBtn">START BRUSHING</button>
  <button id="pauseBtn" style="display:none;">PAUSE</button>
  <button id="resetBtn" style="display:none;">RESTART QUEST</button>
  <button id="manualBtn">MANUAL BRUSH</button>
  <div class="xp-bar">
    <div class="xp-fill" id="xp"></div>
  </div>
  <div class="streak" id="streak"></div>
  <div class="totalDays" id="totalDays"></div>
</div>

<div class="achievement" id="achievement">
  TREASURE UNLOCKED<br><br>
  SUPER CLEAN TEETH<br><br>
  Oscar Level Up!
</div>

<script>
let totalTime=120;
let timeLeft=120;
let interval;
let isPaused=false;
let startTime=0;

const timer=document.getElementById("timer");
const zone=document.getElementById("zone");
const xp=document.getElementById("xp");
const achievement=document.getElementById("achievement");
const startBtn=document.getElementById("startBtn");
const pauseBtn=document.getElementById("pauseBtn");
const resetBtn=document.getElementById("resetBtn");
const manualBtn=document.getElementById("manualBtn");
const streakDisplay=document.getElementById("streak");
const totalDisplay=document.getElementById("totalDays");

const zones=[
  "Top Left Zone",
  "Top Right Zone",
  "Bottom Left Zone",
  "Bottom Right Zone"
];

const biomes=[
  "Plains","Flower Forest","Nether","The End"
];

const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
function beep(){
  const osc=audioCtx.createOscillator();
  const gain=audioCtx.createGain();
  osc.connect(gain); gain.connect(audioCtx.destination);
  osc.type="square"; osc.frequency.value=800;
  gain.gain.setValueAtTime(0.1,audioCtx.currentTime);
  osc.start(); osc.stop(audioCtx.currentTime+0.08);
}

// ---------- LocalStorage Tracking ----------
function getToday(){return new Date().toISOString().split('T')[0];}
function loadData(){return {streak:parseInt(localStorage.getItem('streak')||0),total:parseInt(localStorage.getItem('totalDays')||0),last:localStorage.getItem('lastDate')||""};}
function saveData(d){localStorage.setItem('streak',d.streak); localStorage.setItem('totalDays',d.total); localStorage.setItem('lastDate',d.last);}
function updateUI(){let d=loadData(); streakDisplay.innerText="Streak: "+d.streak; totalDisplay.innerText="Total days brushed: "+d.total;}
function rewardCheck(streak){if(streak%7===0) achievement.style.display="block";}
function registerBrush(){
  let d=loadData(); const today=getToday();
  if(d.last!==today){
    let y=new Date(); y.setDate(y.getDate()-1); const yd=y.toISOString().split('T')[0];
    if(d.last===yd) d.streak++; else d.streak=1;
    d.total++; d.last=today; saveData(d); updateUI(); rewardCheck(d.streak);
  }
}

// ---------- Timer Logic ----------
function update(){
  let m=Math.floor(timeLeft/60);
  let s=timeLeft%60;
  timer.textContent=(m<10?"0":"")+m+":"+(s<10?"0":"")+s;
  let progress=((totalTime-timeLeft)/totalTime)*100;
  xp.style.width=progress+"%";
  let zoneIndex=Math.floor((totalTime-timeLeft)/30);
  if(zoneIndex<4) zone.textContent=zones[zoneIndex];
  if(timeLeft===10) document.body.classList.add("warning");
}

function orb(){
  const o=document.createElement("div");
  o.className="orb"; o.style.left=Math.random()*window.innerWidth+"px"; o.style.bottom="0px";
  document.body.appendChild(o); setTimeout(()=>o.remove(),2000);
}

function finish(){
  clearInterval(interval);
  achievement.style.display="block";
  zone.textContent="Quest Complete!";
  startBtn.style.display="none"; pauseBtn.style.display="none"; resetBtn.style.display="block";
  if(navigator.vibrate) navigator.vibrate([200,100,200]);
  document.body.classList.remove("warning");
  registerBrush();
}

function tick(){
  if(isPaused) return;
  timeLeft--;
  beep();
  update();
  orb();
  if(timeLeft<=0) finish();
}

function start(){
  startBtn.style.display="none"; pauseBtn.style.display="block";
  startTime=Date.now();
  interval=setInterval(tick,1000);
}

function pause(){
  isPaused=!isPaused;
  pauseBtn.textContent=isPaused?"RESUME":"PAUSE";
}

function reset(){
  clearInterval(interval); timeLeft=totalTime; xp.style.width="0%"; achievement.style.display="none";
  zone.textContent="Tap Start To Begin"; startBtn.style.display="block"; pauseBtn.style.display="none"; resetBtn.style.display="none";
  timer.textContent="02:00"; isPaused=false; document.body.classList.remove("warning");
}

startBtn.addEventListener("click",start);
pauseBtn.addEventListener("click",pause);
resetBtn.addEventListener("click",reset);
manualBtn.addEventListener("click",registerBrush);

updateUI();
</script>

</body>
</html>
