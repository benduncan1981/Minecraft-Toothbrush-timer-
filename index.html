<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Oscar's Tooth Quest</title>
<style>
body {
  margin:0;
  overflow:hidden;
  font-family:'Press Start 2P', monospace;
  background:black;
}
canvas {
  image-rendering: pixelated;
  display:block;
}
#ui {
  position:absolute;
  top:10px;
  left:10px;
  color:white;
  z-index:10;
  font-size:18px;
  text-shadow:2px 2px 4px black;
}
button {
  display:block;
  margin-top:5px;
  font-size:14px;
}
#reward {
  position:absolute;
  bottom:20px;
  width:100%;
  text-align:center;
  font-size:28px;
  color:gold;
  text-shadow:3px 3px 6px black;
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="ui">
  <div id="timer">02:00</div>
  <div id="biome">Tap Start to Begin</div>
  <div id="streak"></div>
  <div id="totalDays"></div>
  <button onclick="startBrush()">START BRUSHING</button>
  <button onclick="manualBrush()">Add Manual Brush</button>
</div>
<div id="reward"></div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const TILE = 32;
let brushing=false;
let startTime=0;
let arrows=[];
let dragonX=0, dragonDir=2;
let rewardMessage="";
let zones = [
  {x:100, y:canvas.height-250, w:100, h:50, brushed:false},
  {x:220, y:canvas.height-250, w:100, h:50, brushed:false},
  {x:100, y:canvas.height-180, w:100, h:50, brushed:false},
  {x:220, y:canvas.height-180, w:100, h:50, brushed:false}
];

/* ---------- STORAGE ---------- */
function getToday(){ return new Date().toISOString().split('T')[0]; }
function loadData(){
  return {
    streak: parseInt(localStorage.getItem('streak')||0),
    total: parseInt(localStorage.getItem('totalDays')||0),
    last: localStorage.getItem('lastDate')||""
  };
}
function saveData(d){
  localStorage.setItem('streak',d.streak);
  localStorage.setItem('totalDays',d.total);
  localStorage.setItem('lastDate',d.last);
}
function updateUI(){
  const d=loadData();
  document.getElementById('streak').innerText="Streak: "+d.streak;
  document.getElementById('totalDays').innerText="Total days brushed: "+d.total;
}
function rewardCheck(streak){ if(streak%7===0) rewardMessage="Weekly Reward Unlocked!"; }
function registerBrush(){
  let d=loadData();
  const today=getToday();
  if(d.last!==today){
    let y=new Date(); y.setDate(y.getDate()-1);
    const yd=y.toISOString().split('T')[0];
    if(d.last===yd) d.streak++; else d.streak=1;
    d.total++; d.last=today;
    rewardCheck(d.streak);
    saveData(d); updateUI();
  }
}
function manualBrush(){ registerBrush(); }

/* ---------- START ---------- */
function startBrush(){
  brushing=true;
  startTime=Date.now();
  arrows=[]; rewardMessage="";
  zones.forEach(z=>z.brushed=false);
  document.getElementById('biome').innerText="Overworld Plains";
}

/* ---------- BLOCK DRAWING ---------- */
function block(x,y,w,h,color){
  ctx.fillStyle=color;
  ctx.fillRect(x,y,w,h);
  ctx.strokeStyle='rgba(0,0,0,0.2)';
  ctx.strokeRect(x,y,w,h);
}

/* ---------- BIOMES ---------- */
function drawPlains(){
  ctx.fillStyle='#87CEEB';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  for(let x=0;x<canvas.width;x+=TILE){
    block(x,canvas.height-200,TILE,200,'#3CB043');
  }
  drawCloud(200,100); drawCloud(500,150);
  drawTree(150,canvas.height-240); drawTree(450,canvas.height-240);
  drawSheep(350,canvas.height-180);
}
function drawFlowerForest(){
  ctx.fillStyle='#A7D8FF';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  for(let x=0;x<canvas.width;x+=TILE){
    block(x,canvas.height-200,TILE,200,'#4CAF50');
  }
  drawCloud(300,120); drawCloud(600,160);
  drawTree(200,canvas.height-240); drawTree(500,canvas.height-240);
  drawSheep(400,canvas.height-180);
  for(let i=0;i<10;i++){
    ctx.fillStyle='pink'; ctx.fillRect(i*100,canvas.height-210,8,8);
  }
}
function drawNether(){
  ctx.fillStyle='#330000'; ctx.fillRect(0,0,canvas.width,canvas.height);
  for(let x=0;x<canvas.width;x+=TILE){
    block(x,canvas.height-200,TILE,200,'#8B0000');
  }
  ctx.fillStyle='orange'; ctx.fillRect(0,canvas.height-100,canvas.width,100);
  drawPiglin(canvas.width/2,canvas.height-180);
}
function drawEnd(){
  ctx.fillStyle='#111122'; ctx.fillRect(0,0,canvas.width,canvas.height);
  for(let x=0;x<canvas.width;x+=TILE){
    block(x,canvas.height-200,TILE,200,'#444');
  }
  drawDragon();
  if(Math.random()<0.2){ arrows.push({x:canvas.width/2,y:canvas.height-200}); }
  arrows.forEach(a=>{ a.y-=8; ctx.fillStyle='white'; ctx.fillRect(a.x,a.y,4,20); });
}

/* ---------- OBJECTS ---------- */
function drawCloud(x,y){ ctx.fillStyle='white'; ctx.fillRect(x,y,96,32); ctx.fillRect(x+16,y-16,64,32);}
function drawTree(x,y){ block(x,y,32,64,'#8B5A2B'); ctx.fillStyle='#228B22'; ctx.fillRect(x-16,y-32,64,64);}
function drawSheep(x,y){ ctx.fillStyle='white'; ctx.fillRect(x,y,32,16);}
function drawPiglin(x,y){ ctx.fillStyle='#ffb6c1'; ctx.fillRect(x,y,32,24);}
function drawDragon(){ dragonX+=dragonDir; if(dragonX<100||dragonX>canvas.width-200) dragonDir*=-1; ctx.fillStyle='#551A8B'; ctx.fillRect(dragonX,150,160,32); ctx.fillRect(dragonX+40,120,64,32);}

/* ---------- ZONES INTERACTION ---------- */
canvas.addEventListener('pointerdown', e=>{
  if(!brushing) return;
  const rect=canvas.getBoundingClientRect();
  const mx=e.clientX-rect.left;
  const my=e.clientY-rect.top;
  zones.forEach(z=>{
    if(!z.brushed && mx>z.x && mx<z.x+z.w && my>z.y && my<z.y+z.h){
      z.brushed=true;
      for(let i=0;i<5;i++){
        ctx.fillStyle='pink'; ctx.fillRect(z.x+Math.random()*z.w,z.y+Math.random()*z.h,4,4);
      }
      if('vibrate' in navigator) navigator.vibrate(50);
    }
  });
});

/* ---------- MAIN LOOP ---------- */
function animate(){
  requestAnimationFrame(animate);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(!brushing) return;

  const elapsed=(Date.now()-startTime)/1000;
  const timeLeft=Math.max(0,120-elapsed);
  document.getElementById('timer').innerText='Time: '+Math.ceil(timeLeft);

  let biomeIndex=Math.floor(elapsed/30); if(biomeIndex>3) biomeIndex=3;
  document.getElementById('biome').innerText='Biome: '+biomes[biomeIndex];

  if(biomeIndex===0) drawPlains();
  if(biomeIndex===1) drawFlowerForest();
  if(biomeIndex===2) drawNether();
  if(biomeIndex===3) drawEnd();

  if(elapsed>=120){
    brushing=false;
    registerBrush();
    document.getElementById('reward').innerText=rewardMessage;
  }
}

updateUI();
animate();
</script>
</body>
</html>
